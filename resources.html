<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YDTL.</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      color: white;
      font-family: "Courier New", Courier, monospace;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      align-items: center;
    }

    nav {
      width: 100%;
      padding: 12px 0;
      background-color: #111;
      display: flex;
      justify-content: center;
      gap: 2rem;
      border-bottom: 1px solid #333;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-size: 1rem;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .search-section {
      text-align: center;
      padding: 20px;
    }

    .search-section input, .search-section button {
      font-size: 1rem;
      padding: 10px;
      margin: 5px;
      width: 250px;
      max-width: 90vw;
    }

    .search-section button {
      cursor: pointer;
    }

    #content-box {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    #state-display {
      font-size: 1.3rem;
      white-space: pre-line;
    }

    #suggestion {
      color: yellow;
      font-size: 0.9rem;
    }

    .footer {
      font-size: 0.9rem;
      color: gray;
      text-align: center;
      padding: 15px 10px;
      border-top: 1px solid #333;
      width: 100%;
    }

    .footer a {
      color: gray;
      text-decoration: underline;
    }

    .footer a:hover {
      color: lightgray;
    }

    @media (max-width: 600px) {
      nav {
        gap: 1rem;
        font-size: 0.9rem;
      }

      #state-display {
        font-size: 1.1rem;
      }

      .search-section input {
        width: 200px;
      }

      .footer {
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>

  <nav>
    <a href="/">Home</a>
    <a href="/resources">Resources</a>
    <a href="/about">About</a>
  </nav>

  <div class="search-section">
    <p>Incorrect area? Enter your location:</p>
    <input type="text" id="manual-input" placeholder="State or Country" />
    <button onclick="searchLocation()">Search</button>
    <p id="suggestion"></p>
  </div>

  <div id="content-box">
    <p id="state-display">Fetching IP info...</p>
  </div>

  <div class="footer">
    In memory of <a href="https://github.com/youdeservetolive/youdeservetolive.github.io/blob/main/README.md" target="_blank">Joshua Blackledge</a> â€” created by Elijah Segers and Maddie Andros
  </div>

  <script>
    let detectedCountry = "";
    let detectedRegion = "";

    const validStates = [
      "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware",
      "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky",
      "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi",
      "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico",
      "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania",
      "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont",
      "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"
    ];

    const validCountries = [
      "United States", "Canada", "Mexico", "Brazil", "Argentina", "United Kingdom", "France", "Germany",
      "Italy", "Spain", "China", "Japan", "India", "Russia", "South Africa", "Australia"
    ];

    async function getLocation() {
      try {
        const response = await fetch("https://ipwhois.app/json/");
        const data = await response.json();
        console.log("Location Data:", data);

        detectedCountry = capitalizeWords(data.country);
        detectedRegion = capitalizeWords(data.region);

        updateDisplay(`${detectedRegion} CONFIRMED`);

        if (detectedCountry === "United States") {
          searchFiles(detectedRegion, "United States");
        } else {
          searchFiles(detectedCountry, detectedCountry);
        }
      } catch (error) {
        console.error("Error getting location:", error);
        updateDisplay("Error detecting location.");
      }
    }

    function searchLocation() {
      let input = document.getElementById("manual-input").value.trim();
      if (!input) return alert("Please enter a location.");

      input = capitalizeWords(input);
      let match = findClosestMatch(input);

      if (match && match.toLowerCase() !== input.toLowerCase()) {
        document.getElementById("suggestion").textContent = `Did you mean: ${match}?`;
        input = capitalizeWords(match);
      } else {
        document.getElementById("suggestion").textContent = "";
      }

      if (validStates.includes(input)) {
        searchFiles(input, "United States");
      } else if (validCountries.includes(input)) {
        searchFiles(input, input);
      } else {
        updateDisplay(`No data available for "${input}".`);
      }
    }

    async function searchFiles(region, country) {
      const path = country === "United States" 
        ? `United States/${region}.txt` 
        : `${country}/${country}.txt`;

      try {
        const response = await fetch(path);
        if (!response.ok || response.headers.get("Content-Type").includes("text/html")) {
          throw new Error("File not found");
        }

        const text = await response.text();
        updateDisplay(formatText(text.trim()));
      } catch {
        updateDisplay(`No data available for ${region}.`);
      }
    }

    function updateDisplay(text) {
      document.getElementById("state-display").innerHTML = text;
    }

    function capitalizeWords(str) {
      return str
        .toLowerCase()
        .split(" ")
        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
        .join(" ");
    }

    function formatText(text) {
      // Phone numbers
      text = text.replace(/(\+?\d{1,3}[-.\s]?)?(\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4})/g, '<a href="tel:$&">$&</a>');
      // URLs
      text = text.replace(/(https?:\/\/[^\s]+|www\.[^\s]+)/g, url => {
        let clean = url.startsWith("www.") ? "http://" + url : url;
        return `<a href="${clean}" target="_blank">${url}</a>`;
      });
      return text;
    }

    function findClosestMatch(input) {
      const list = [...validStates, ...validCountries];
      let closest = "";
      let minDist = Infinity;

      for (const loc of list) {
        const dist = levenshtein(input.toLowerCase(), loc.toLowerCase());
        if (dist < minDist) {
          minDist = dist;
          closest = loc;
        }
      }

      return minDist <= 2 ? closest : "";
    }

    function levenshtein(a, b) {
      const m = a.length, n = b.length;
      const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));
      for (let i = 0; i <= m; i++) dp[i][0] = i;
      for (let j = 0; j <= n; j++) dp[0][j] = j;

      for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
          if (a[i - 1] === b[j - 1]) {
            dp[i][j] = dp[i - 1][j - 1];
          } else {
            dp[i][j] = Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]) + 1;
          }
        }
      }

      return dp[m][n];
    }

    getLocation();
  </script>
</body>
</html>
