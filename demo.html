<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YDTL.</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: "Courier New", Courier, monospace;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        h1 {
            font-size: 2rem;
            transition: opacity 0.5s ease-in-out; /* Smooth fade-out effect */
        }
        p {
            font-size: 1.5rem;
            margin-bottom: 20px;
            white-space: pre-line; /* Ensures new lines are displayed */
        }
        input, button {
            font-size: 1rem;
            padding: 10px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1 id="location-title">Detecting Your Location...</h1>
    <p id="state-display">Fetching IP info...</p>

    <!-- Search Input -->
    <p>Incorrect area? Please enter your area name to search:</p>
    <input type="text" id="manual-input" placeholder="Enter state or country">
    <button onclick="searchLocation()">Search</button>
    <p id="suggestion" style="color: yellow;"></p>

    <script>
        let detectedCountry = "";
        let detectedRegion = "";

        // List of all 50 U.S. states and 195 countries
        const validLocations = [
            "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware",
            "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky",
            "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi",
            "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico",
            "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania",
            "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont",
            "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming",
            "United States", "Canada", "Mexico", "Brazil", "Argentina", "United Kingdom", "France", "Germany",
            "Italy", "Spain", "Portugal", "Netherlands", "Belgium", "Sweden", "Norway", "Denmark", "Finland",
            "Russia", "China", "Japan", "South Korea", "India", "Pakistan", "Bangladesh", "Indonesia",
            "Australia", "New Zealand", "South Africa", "Egypt", "Turkey", "Saudi Arabia", "Iran", "Iraq",
            "Syria", "Afghanistan", "Thailand", "Vietnam", "Malaysia", "Singapore", "Philippines",
            "Israel", "Ukraine", "Poland", "Greece", "Romania", "Hungary", "Switzerland", "Austria",
            "Ireland", "Czech Republic", "Slovakia", "Bulgaria", "Serbia", "Croatia", "Slovenia", "Lithuania",
            "Latvia", "Estonia", "Belarus", "Kazakhstan", "Uzbekistan", "Armenia", "Georgia", "Azerbaijan",
            "United Arab Emirates", "Kuwait", "Qatar", "Bahrain", "Oman", "Lebanon", "Jordan", "Yemen",
            "Ethiopia", "Kenya", "Nigeria", "Ghana", "Ivory Coast", "Algeria", "Morocco", "Tunisia",
            "Libya", "Sudan", "South Sudan", "Zambia", "Zimbabwe", "Botswana", "Namibia", "Mozambique",
            "Madagascar", "Angola", "Congo", "Tanzania", "Uganda", "Cameroon", "Senegal", "Mali", "Niger",
            "Chad", "Burkina Faso", "Mauritania", "Somalia", "Central African Republic", "Eritrea",
            "Djibouti", "Rwanda", "Burundi", "Sierra Leone", "Liberia", "Togo", "Benin", "Guinea", "Eswatini",
            "Lesotho", "Seychelles", "Malawi", "Gabon", "Gambia", "Comoros", "Mauritius", "Cape Verde"
        ];

        async function getLocation() {
            try {
                // Fetch user location data from a free API
                const response = await fetch('https://ipwhois.app/json/');
                const data = await response.json();

                // Print the full API response to the console
                console.log("Full API Response:", data);

                // Extract the detected country and region
                detectedCountry = data.country;
                detectedRegion = data.region;

                // Display the confirmation message
                document.getElementById("state-display").textContent = `${detectedRegion.toUpperCase()} CONFIRMED`;

                // Hide "Detecting Your Location..." smoothly
                document.getElementById("location-title").style.opacity = "0";
                setTimeout(() => {
                    document.getElementById("location-title").style.display = "none";
                }, 500);

                // Try to load a location file based on detected country & region
                searchFiles(detectedRegion, detectedCountry);

            } catch (error) {
                console.error("Error fetching location:", error);
                document.getElementById("state-display").textContent = "Error fetching location.";
            }
        }

        function searchLocation() {
            let userInput = capitalizeFirstLetter(document.getElementById("manual-input").value.trim());
            if (!userInput) {
                alert("Please enter a location.");
                return;
            }
        
            // Check for spelling mistakes and suggest the closest match
            let correctedName = findClosestMatch(userInput);
            if (correctedName && correctedName.toLowerCase() !== userInput.toLowerCase()) {
                document.getElementById("suggestion").textContent = `Did you mean: ${correctedName}?`;
                userInput = capitalizeFirstLetter(correctedName); // Auto-correct input with capitalization
            } else {
                document.getElementById("suggestion").textContent = "";
            }
        
            // Try to load the file based on corrected user input
            searchFiles(userInput, detectedCountry || "Global");
        }


        async function searchFiles(region, country) {
            const folderPath = `${country}/${region}.txt`;

            try {
                const response = await fetch(folderPath);

                // Check if the response is valid and not an HTML file
                if (!response.ok || response.headers.get("Content-Type").includes("text/html")) {
                    throw new Error("File not found");
                }

                // Read the file contents and display multiple lines correctly
                const text = await response.text();
                document.getElementById("state-display").textContent = text.trim();

            } catch (error) {
                console.warn(`File not found for ${region}, showing fallback message.`);
                document.getElementById("state-display").textContent = `No data available for ${region}.`;
            }
        }

        function findClosestMatch(input) {
            let closestMatch = "";
            let shortestDistance = Infinity;

            validLocations.forEach(location => {
                let distance = levenshteinDistance(input.toLowerCase(), location.toLowerCase());
                if (distance < shortestDistance) {
                    shortestDistance = distance;
                    closestMatch = location;
                }
            });

            return shortestDistance <= 2 ? closestMatch : "";
        }

        function levenshteinDistance(a, b) {
            const matrix = Array.from({ length: a.length + 1 }, (_, i) =>
                Array.from({ length: b.length + 1 }, (_, j) => (i === 0 ? j : j === 0 ? i : 0))
            );

            for (let i = 1; i <= a.length; i++) {
                for (let j = 1; j <= b.length; j++) {
                    matrix[i][j] =
                        a[i - 1] === b[j - 1]
                            ? matrix[i - 1][j - 1]
                            : Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + 1);
                }
            }

            return matrix[a.length][b.length];
        }

        getLocation();
    </script>
</body>
</html>
