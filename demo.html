<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Location Detector</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: "Courier New", Courier, monospace;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        h1 {
            font-size: 2rem;
        }
        p {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        input, button {
            font-size: 1rem;
            padding: 10px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>Detecting Your Location...</h1>
    <p id="state-display">Fetching IP info...</p>

    <!-- Search Input -->
    <p>Incorrect area? Please enter your area name to search:</p>
    <input type="text" id="manual-input" placeholder="Enter state or country">
    <button onclick="searchLocation()">Search</button>

    <script>
        let detectedCountry = "";
        let detectedRegion = "";

        async function getLocation() {
            try {
                // Fetch user location data from a free API
                const response = await fetch('https://ipwhois.app/json/');
                const data = await response.json();

                // Print the full API response to the console
                console.log("Full API Response:", data);

                // Extract the detected country and region
                detectedCountry = data.country;
                detectedRegion = data.region;

                // Display the confirmation message
                document.getElementById("state-display").textContent = `${detectedRegion.toUpperCase()} CONFIRMED`;

                // Try to load a location file based on detected country & region
                searchFiles(detectedRegion, detectedCountry);

            } catch (error) {
                console.error("Error fetching location:", error);
                document.getElementById("state-display").textContent = "Error fetching location.";
            }
        }

        function searchLocation() {
            const userInput = document.getElementById("manual-input").value.trim();
            if (!userInput) {
                alert("Please enter a location.");
                return;
            }

            // Try to load the file based on user input
            searchFiles(userInput, detectedCountry || "Global");
        }

        function searchFiles(region, country) {
            const folderPath = `${country}/${region}.txt`; 

            fetch(folderPath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("File not found");
                    }
                    return response.text();
                })
                .then(text => {
                    document.getElementById("state-display").textContent = text;
                })
                .catch(() => {
                    document.getElementById("state-display").textContent = `No data available for ${region}.`;
                });
        }

        getLocation();
    </script>
</body>
</html>
